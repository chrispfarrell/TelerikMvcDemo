(function(e){var b=e.telerik;var d=3;var a=0;b.scripts.push("telerik.grid.grouping.js");b.grouping={};function c(f,g){return f.find("div").filter(function(){var h=e(this);if(h.children(".t-link").contents().filter(function(){if(e(this).text()===g){return e(this)}}).length){return e(this)}})}b.grouping.initialize=function(g){e.extend(g,b.grouping.implementation);g.$groupDropCue=e('<div class="t-grouping-dropclue"/>');g.$groupHeader=e("> .t-grouping-header",g.element);function i(){var l=e.map(g.$groupHeader.find(".t-group-indicator"),function(m){var n=e(m);var o=n.offset().left;var p=n.outerWidth();return{left:o,right:o+p,width:p,$group:n}});return{first:l[0],all:l,last:l[l.length-1]}}function h(v){var m=v.$cue.text();if(!e.contains(g.element,v.target)||!e(v.target).closest(".t-grouping-header").length||(g.groupFromTitle(m)&&v.$draggable.closest(".t-header").length)){g.$groupDropCue.remove();return}var x=e(g.element),p=x.find("> .t-grid-toolbar"),n=p.outerHeight()+d,r=i(),q=x.closest(".t-rtl").length;if(!r.all.length){var s=q?p.width()-a:a;g.$groupDropCue.css({top:n,left:s}).appendTo(g.$groupHeader);return}var w=r.first;var u=r.last;var l=parseInt(w.$group.css("marginLeft"));var t=parseInt(w.$group.css("marginRight"));var o=e.grep(r.all,function(y){return v.pageX>=y.left-l-t&&v.pageX<=y.right})[0];if(!o&&w){if(!q&&v.pageX<w.left){o=w}else{if(q&&v.pageX<u.left){o=u}}}if(q){if(o){g.$groupDropCue.css({top:n,left:o.$group.position().left-l+a}).insertAfter(o.$group)}else{g.$groupDropCue.css({top:n,left:p.width()-a}).prependTo(g.$groupHeader)}}else{if(o){g.$groupDropCue.css({top:n,left:o.$group.position().left-l+a}).insertBefore(o.$group)}else{g.$groupDropCue.css({top:n,left:u.$group.position().left+u.$group.outerWidth()+t+a}).appendTo(g.$groupHeader)}}}function k(o){if(o.$draggable.hasClass("t-header")){var l=g.columnFromTitle(o.$draggable.text());return b.dragCue(l?l.title:"")}else{var n=e(".t-link",o.$draggable);var m=n.text().substr(e(".t-icon",n).text().length);var l=g.columnFromTitle(m);return b.dragCue(l?l.title:m)}}function j(l){var m=l.$cue.text();g.$groupDropCue.remove();if(l.$draggable.is(".t-group-indicator")&&l.keyCode!=27){g.unGroup(m);return false}}function f(l){l.$cue.remove()}if(g.$groupHeader.length){new b.draggable({owner:g.$header,selector:".t-header:not(.t-group-cell,.t-hierarchy-cell)",scope:g.element.id+"-grouping",cue:k,start:function(l){var m=g.columnFromTitle(l.$draggable.text());return !!m.member&&m.groupable!==false},stop:j,drag:h,destroy:f});new b.draggable({owner:g.$groupHeader,selector:".t-group-indicator",scope:g.element.id+"-grouping",cue:k,stop:j,drag:h,destroy:f});new b.droppable({owner:g.element,selector:".t-grouping-header",scope:g.element.id+"-grouping",over:function(l){b.dragCueStatus(l.$cue,"t-add")},out:function(l){b.dragCueStatus(l.$cue,"t-denied")},drop:function(p){var l=p.$cue.text();var m=g.groupFromTitle(l);var o=e.inArray(m,g.groups);var n=g.$groupHeader.find("div").index(g.$groupDropCue);var q=o-n;if(!m||(g.$groupDropCue.is(":visible")&&q!=0&&q!=-1)){g.group(l,n)}g.$groupDropCue.remove()}})}if(g.isAjax()){g.$groupHeader.delegate(".t-button","click",function(n){n.preventDefault();var m=e(this).parent().find(".t-link");var l=m.text().substr(e(".t-icon",m).text().length);g.unGroup(l)}).delegate(".t-link","click",function(o){o.preventDefault();var n=e(this);var l=n.text().substr(e(".t-icon",n).text().length);var m=g.groupFromTitle(l);m.order=m.order=="asc"?"desc":"asc";g.group(m.title)})}g.$groupHeader.delegate(".t-group-indicator","mouseenter",function(){g.$currentGroupItem=e(this)}).delegate(".t-group-indicator","mouseleave",function(){g.$currentGroupItem=null});g.$tbody.delegate(".t-grouping-row .t-collapse, .t-grouping-row .t-expand","click",b.stop(function(m){m.preventDefault();var n=e(this),l=n.closest("tr");if(n.hasClass("t-collapse")){g.collapseGroup(l)}else{g.expandGroup(l)}}));g.groupFromTitle=function(l){return e.grep(g.groups,function(m){return m.title==l})[0]};g.expandGroup=function(m){var n=e(m);var l=n.find(".t-group-cell").length;n.nextAll("tr").each(function(p,q){var o=e(q);var r=o.find(".t-group-cell").length;if(r<=l){return false}if(r==l+1&&!o.hasClass("t-detail-row")){o.show();if(o.hasClass("t-grouping-row")&&o.find(".t-icon").hasClass("t-collapse")){g.expandGroup(o)}if(o.hasClass("t-master-row")&&o.find(".t-icon").hasClass("t-minus")){o.next().show()}}});n.find(".t-icon").addClass("t-collapse").removeClass("t-expand")};g.collapseGroup=function(m){var n=e(m),l=n.find(".t-group-cell").length,o=1;n.nextAll("tr").each(function(){var p=e(this),q=p.find(".t-group-cell").length;if(p.hasClass("t-grouping-row")){o++}else{if(p.hasClass("t-group-footer")){o--}}if(q<=l||(p.hasClass("t-group-footer")&&o<0)){return false}p.hide()});n.find(".t-icon").addClass("t-expand").removeClass("t-collapse")};g.group=function(m,p){if(this.groups.length==0&&this.isAjax()){g.$groupHeader.empty()}var n=e.grep(g.groups,function(r){return r.title==m})[0];if(!n){var o=g.columnFromTitle(m);n={order:"asc",member:o.member,title:m};g.groups.push(n)}if(p>=0){g.groups.splice(e.inArray(n,g.groups),1);g.groups.splice(p,0,n)}g.groupBy=e.map(g.groups,function(r){return r.member+"-"+r.order}).join("~");if(this.isAjax()){var q=c(this.$groupHeader,m);if(q.length==0){var l=new e.telerik.stringBuilder().cat('<div class="t-group-indicator">').cat('<a href="#" class="t-link"><span class="t-icon" />').cat(m).cat("</a>").cat('<a class="t-button t-button-icon t-button-bare"><span class="t-icon t-group-delete">').cat(g.localization.ungroup).cat("</span></a>").cat("</div>").string();q=e(l).appendTo(this.$groupHeader)}if(this.$groupDropCue.is(":visible")){q.insertBefore(this.$groupDropCue)}q.find(".t-link .t-icon").toggleClass("t-arrow-up-small",n.order=="asc").toggleClass("t-arrow-down-small",n.order=="desc").html("("+(n.order=="asc"?g.localization.sortedAsc:g.localization.sortedDesc)+")");this.ajaxRequest()}else{this.serverRequest()}};g.unGroup=function(m){var l=g.groupFromTitle(m);g.groups.splice(e.inArray(l,g.groups),1);if(g.groups.length==0){g.$groupHeader.html(g.localization.groupHint)}g.groupBy=e.map(g.groups,function(n){return n.member+"-"+n.order}).join("~");if(g.isAjax()){c(g.$groupHeader,m).remove();g.ajaxRequest()}else{g.serverRequest()}},g.normalizeColumns=function(o){var p=g.groups.length;var n=o-g.$tbody.parent().find(" > colgroup > col").length;if(n==0){return}var q=g.$tbody.parent().add(g.$headerWrap.find("table")).add(g.$footer.find("table"));if(e.browser.msie){if(n>0){e(new b.stringBuilder().rep('<col class="t-group-col" />',n).string()).prependTo(q.find("colgroup"));e(new b.stringBuilder().rep('<th class="t-group-cell t-header">&nbsp;</th>',n).string()).insertBefore(q.find("th.t-header:first"));e(new b.stringBuilder().rep('<td class="t-group-cell">&nbsp;</td>',n).string()).insertBefore(q.find("tr.t-footer-template > td:first"))}else{q.find("th:lt("+Math.abs(n)+"), tr.t-footer-template > td:lt("+Math.abs(n)+")").remove().end().find("col:lt("+Math.abs(n)+")").remove()}var l=[];var m=0;e("table, .t-grid-bottom",g.element).each(function(){l.push(this.parentNode)}).appendTo(e("<div />")).each(function(){l[m++].appendChild(this)})}else{q.find("col.t-group-col").remove();e(new b.stringBuilder().rep('<col class="t-group-col" />',p).string()).prependTo(q.find("colgroup"));q.find("th.t-group-cell").remove();q.find("tr.t-footer-template > td.t-group-cell").remove();e(new b.stringBuilder().rep('<th class="t-group-cell t-header">&nbsp;</th>',p).string()).insertBefore(q.find("th.t-header:first"));e(new b.stringBuilder().rep('<td class="t-group-cell">&nbsp;</td>',p).string()).insertBefore(q.find("tr.t-footer-template > td:first"))}},g.bindGroup=function(o,s,r,q){var p=g.groups[q];var u=o.value;var n=e.grep(g.columns,function(l){return p.member==l.member})[0],v;if(n&&(n.format||n.type=="Date")){v=/^\/Date\((.*?)\)\/$/.exec(u);if(v){u=new Date(parseInt(v[1]))}u=b.formatString(n.format||"{0:G}",u)}r.cat('<tr class="t-grouping-row">').rep('<td class="t-group-cell"></td>',q).cat('<td colspan="').cat(s-q).cat('"><p class="t-reset"><a class="t-icon t-collapse" href="#"></a>');if(n){r.cat(n.groupHeader(e.extend({Title:p.title,Key:u},g._mapAggregates(o.aggregates[n.member]))))}else{r.cat(p.title+": "+u)}r.cat("</p></td></tr>");if(o.hasSubgroups){for(var m=0,t=o.items.length;m<t;m++){g.bindGroup(o.items[m],s,r,q+1)}}else{g.bindData(o.items,r,q+1)}if(g.showGroupFooter){r.cat('<tr class="t-group-footer">').rep('<td class="t-group-cell"></td>',g.groups.length).rep('<td class="t-hierarchy-cell"></td>',g.detail?1:0);e.each(g.columns,function(){r.cat("<td>");if(this.groupFooter){r.cat(this.groupFooter(g._mapAggregates(o.aggregates[this.member])))}r.cat("</td>")});r.cat("</tr>")}}}})(jQuery);